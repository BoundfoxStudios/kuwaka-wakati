<kw-page-title>Dashboard</kw-page-title>

<kw-card [contentType]="'chart'">
    <h2 header>Chart</h2>
    @if (chartData$ | async; as chartData) {
    <kw-history-chart body [data]="chartData.data" [dailyWork]="chartData.settings.workPerDay" />
    } @else {
    <kw-loading-spinner></kw-loading-spinner>
    }
</kw-card>

<kw-card class="mt-4">
    <div header>Overall</div>
    @if (overall$ | async; as overall) {
    <kw-overall body [overall]="overall"></kw-overall>
    } @else {
    <kw-loading-spinner></kw-loading-spinner>
    }
</kw-card>

<kw-card class="mt-4">
    <div header class="flex flex-1">
        <h2 class="whitespace-nowrap">
            Today @if (isWorkDayDone$ | async) {
            <fa-icon [icon]="faCheckCircle" class="ml-1 text-green" />
            }
        </h2>
        <fa-icon [icon]="isTimeEntryVisible ? faClose : faPlus" class="ml-auto cursor-pointer" (click)="isTimeEntryVisible = !isTimeEntryVisible" />
    </div>
    @if (today$ | async; as today) {
    <ng-container body>
        @if (settings$ | async; as settings) { @if (isTimeEntryVisible) {
        <kw-time-entry [isTodayMode]="true" (timeEntry)="addTimeEntry($event)" [settings]="settings" class="mb-2 self-end" />
        } } @else {
        <kw-loading-spinner></kw-loading-spinner>
        }
        <kw-today [today]="today" />
        @if (today.items.length) {
        <kw-time-table [times]="today.items" (delete)="deleteTimeEntry($event)"></kw-time-table>
        }
    </ng-container>
    } @else {
    <kw-loading-spinner></kw-loading-spinner>
    }
</kw-card>

<kw-card class="mt-4">
    <div header class="flex flex-1">
        <h2>Week {{ weekNumber$ | async }} ({{ weekFromTo$ | async }})</h2>
        <div class="ml-auto">
            <fa-icon [icon]="faChevronLeft" (click)="updateWeek(-1)" class="cursor-pointer"></fa-icon>
            <fa-icon [icon]="faCalendar" class="ml-4 cursor-pointer" (click)="showThisWeek()"></fa-icon>
            <fa-icon [icon]="faChevronRight" class="ml-4 cursor-pointer" (click)="updateWeek(1)"></fa-icon>
        </div>
    </div>
    @if (week$ | async; as week) {
    <ng-container body>
        <kw-week [week]="week"></kw-week>
        <kw-time-table [times]="week.items"></kw-time-table>
    </ng-container>
    } @else {
    <kw-loading-spinner></kw-loading-spinner>
    }
</kw-card>
